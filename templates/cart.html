{% extends "base.html" %}

{% block content %}

  {# âœ… è·‘é¦¬ç‡ˆçš„ CSSï¼Œå¯ä»¥ç›´æ¥æ”¾åœ¨ body è£¡æ²’é—œä¿‚ #}
  <style>
    .cart-banner {
      margin: 4px 0 10px 0;
      overflow: hidden;
      white-space: nowrap;
      font-size: 13px;
      color: #f97373;  /* è·‘é¦¬ç‡ˆæ–‡å­—é¡è‰²ï¼ˆç²‰ç´…ï¼‰ */
      text-align: left;
    }

    .cart-marquee {
      display: inline-block;
      animation: cart-marquee 16s linear infinite;
    }

    .cart-marquee span {
      padding-right: 3rem;  /* å…©æ®µæ–‡å­—ä¹‹é–“çš„è·é›¢ */
    }

    @keyframes cart-marquee {
      0%   { transform: translateX(100%); }
      100% { transform: translateX(-100%); }
    }
  </style>

  {# âœ… åªæœ‰ã€Œæœ‰å•†å“æ™‚ã€æ‰é¡¯ç¤ºè·‘é¦¬ç‡ˆ #}
  {% if items %}
    <div class="cart-banner">
      <div class="cart-marquee">
        {% if total < SHIPPING_THRESHOLD %}
          {# æœªé”é–€æª»ï¼šæç¤ºé‚„å·®å¤šå°‘å°±å…é‹ #}
          <span>å†è²· {{ SHIPPING_THRESHOLD - total }} å…ƒå°±å…é‹è²»å•¦ï½ ğŸ›’ æŠŠå–œæ­¡çš„é›¶é£Ÿå¤šå¸¶å¹¾æ¨£å§ï¼</span>
          <span>å†è²· {{ SHIPPING_THRESHOLD - total }} å…ƒå°±å…é‹è²»å•¦ï½ ğŸ›’ æŠŠå–œæ­¡çš„é›¶é£Ÿå¤šå¸¶å¹¾æ¨£å§ï¼</span>
        {% else %}
          {# å·²ç¶“é”åˆ°å…é‹é–€æª» #}
          <span>ç¾åœ¨å·²ç¶“é”åˆ° {{ SHIPPING_THRESHOLD }} å…ƒå…é‹è²»é–€æª»ï½ ğŸ‰ æŠŠå–œæ­¡çš„é›¶é£Ÿé€šé€šåŠ é€²è³¼ç‰©è»Šå§ï¼</span>
          <span>ç¾åœ¨å·²ç¶“é”åˆ° {{ SHIPPING_THRESHOLD }} å…ƒå…é‹è²»é–€æª»ï½ ğŸ‰ æŠŠå–œæ­¡çš„é›¶é£Ÿé€šé€šåŠ é€²è³¼ç‰©è»Šå§ï¼</span>
        {% endif %}
      </div>
    </div>
  {% endif %}

  {% if not items %}
    <div style="text-align:center; padding:40px 0;">
      <p style="font-size:22px; margin-bottom:8px;">è³¼ç‰©è»Šæ˜¯ç©ºçš„ï½</p>
      <p class="text-muted" style="margin-bottom:20px;">å»é€›é€›é›¶é£Ÿå€ï¼Œé¸å¹¾æ¨£å–œæ­¡çš„å†å›ä¾†çµå¸³å§ ğŸ˜‹</p>
      <a href="{{ url_for('products') }}" class="btn btn-primary">å‰å¾€å•†å“åˆ—è¡¨</a>
    </div>
  {% else %}
    <div class="cart-layout">
      <!-- å·¦ï¼šè³¼ç‰©æ˜ç´° -->
      <div class="cart-items">
        <table>
          <thead>
            <tr>
              <th style="width:60%;">å•†å“</th>
              <th>å–®åƒ¹</th>
              <th>æ•¸é‡</th>
              <th class="text-right">å°è¨ˆ</th>
            </tr>
          </thead>
          <tbody>
            {% for item in items %}
              <tr>
                <td>
                  <div style="display:flex; align-items:center; gap:10px;">
                    <div style="width:56px; height:56px; border-radius:12px; overflow:hidden; background:#f3f4f6;">
                      <img
                        src="{{ url_for('static', filename='images/products/' ~ item.id ~ '.jpg') }}"
                        alt="{{ item.name }}"
                        style="width:100%; height:100%; object-fit:contain;"
                        onerror="this.src='{{ url_for('static', filename='images/products/placeholder.jpg') }}';"
                      >
                    </div>
                    <div>
                      <div style="font-weight:600;">{{ item.name }}</div>
                      <div class="text-muted" style="font-size:12px;">ç·¨è™Ÿï¼š{{ item.id }}</div>
                    </div>
                  </div>
                </td>
                <td>${{ item.price }}</td>
                <td>
                  <form action="{{ url_for('cart_update') }}" method="post" style="display:flex; align-items:center; gap:6px;">
                    <input type="hidden" name="product_id" value="{{ item.id }}">
                    <input
                      type="number"
                      name="qty"
                      min="1"
                      max="{{ item.stock }}"
                      value="{{ item.qty }}"
                    >
                    <button type="submit" class="btn btn-ghost btn-sm">æ›´æ–°</button>
                  </form>
                </td>
                <td class="text-right">
                  ${{ item.subtotal }}
                  <form action="{{ url_for('cart_remove') }}" method="post" style="display:inline;">
                    <input type="hidden" name="product_id" value="{{ item.id }}">
                    <button type="submit" class="btn btn-ghost btn-sm" title="ç§»é™¤">âœ•</button>
                  </form>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <!-- å³ï¼šè¨‚å–®æ‘˜è¦ -->
      <div class="cart-summary-card">
        <div style="font-size:16px; font-weight:600; margin-bottom:6px;">
          è¨‚å–®æ‘˜è¦
        </div>
        <div class="text-muted" style="font-size:13px; margin-bottom:10px;">
          å…± {{ items|length }} é …å•†å“
        </div>

        <div style="font-size:14px; margin-bottom:4px; display:flex; justify-content:space-between;">
          <span>å•†å“é‡‘é¡å°è¨ˆ</span>
          <span>${{ total }}</span>
        </div>
        <div style="font-size:14px; margin-bottom:4px; display:flex; justify-content:space-between;">
          <span>é‹è²»</span>
          <span>
            {% if shipping_fee == 0 and total > 0 %}
              å…é‹
            {% elif total == 0 %}
              $0
            {% else %}
              ${{ shipping_fee }}
            {% endif %}
          </span>
        </div>
        <div style="font-size:16px; font-weight:700; margin-bottom:14px; display:flex; justify-content:space-between;">        
          <span>æ‡‰ä»˜é‡‘é¡</span>
          <span>${{ grand_total }}</span>
        </div>

        <form action="{{ url_for('checkout') }}" method="post">
          <button type="submit" class="btn btn-primary" style="width:100%; justify-content:center;">çµå¸³</button>
        </form>

        <div style="margin-top:10px; text-align:center;">
          <a href="{{ url_for('products') }}" class="text-muted" style="font-size:13px; text-decoration:none;">
            ç¹¼çºŒè³¼ç‰©
          </a>
        </div>
      </div>
    </div>
  {% endif %}
{% endblock %}
