{% extends "base.html" %}

{% block content %}

  <!-- å•†å“è©³ç´°è³‡è¨Šèªªæ˜ï¼šåªå‡ºç¾åœ¨å•†å“åˆ—è¡¨é€™ä¸€é  -->
  <div class="info-hint-row">
    <span class="info-hint-icon">?</span>
    <span>å•†å“è©³ç´°è³‡è¨Šè«‹é»é¸å•†å“å¡ç‰‡å³ä¸Šè§’çš„ã€Œ?ã€æŒ‰éˆ•ã€‚</span>
  </div>

  {% for category, items in products_by_category.items() %}
    <section style="margin-bottom: 20px;">
      <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:6px;">
        <h2 style="margin:0; font-size:18px;">{{ category }}</h2>
        <span class="tag">åˆ†é¡ Â· {{ items|length }} é …å•†å“</span>
      </div>

      <div class="product-grid">
        {% for p in items %}
          {# ğŸ‘‡ åº«å­˜ 0 çš„å•†å“åŠ ä¸Š sold-out class #}
          <div class="product-card {% if p.stock == 0 %}sold-out{% endif %}">

            {# ğŸ‘‡ åº«å­˜ 0 æ™‚ï¼Œæ•´å¼µå¡ç‰‡æ­£ä¸­å¤®é¡¯ç¤ºã€Œç¼ºè²¨ã€è²¼ç´™ #}
            {% if p.stock == 0 %}
              <div class="sold-out-badge">ç¼ºè²¨</div>
            {% endif %}

            {# å³ä¸Šè§’å°è³‡è¨ŠæŒ‰éˆ• #}
            <button
              type="button"
              class="product-info-btn product-info-toggle"
              title="æŸ¥çœ‹å•†å“è©³ç´°è³‡è¨Š"
            >
              ?
            </button>

            {# ä¸ŠåŠéƒ¨ï¼šåœ–ç‰‡ + åç¨± + åƒ¹æ ¼ + åŠ å…¥è³¼ç‰©è»Š #}
            <div class="product-main">
              <div class="product-thumb">
                <img
                  src="{{ url_for('static', filename='images/products/' ~ p.id ~ '.jpg') }}"
                  alt="{{ p.name }}"
                  onerror="this.src='{{ url_for('static', filename='images/logo2.png') }}';"
                >
              </div>

              <div class="product-body">
                <div class="product-title">{{ p.name }}</div>

                <div class="product-meta-row">
                  <span class="product-meta">ç·¨è™Ÿï¼š{{ p.id }}</span>
                  <span class="product-meta">
                    {% if p.stock == 0 %}
                      å·²å”®å®Œ
                    {% else %}
                      åº«å­˜ï¼š{{ p.stock }}
                    {% endif %}
                  </span>
                </div>

                <div class="product-bottom">
                  <div class="product-price">
                    ${{ p.price }} <span>/ å–®ä»¶</span>
                  </div>

                  <form
                    action="{{ url_for('add_to_cart') }}"
                    method="post"
                    class="product-actions"
                  >
                    <input type="hidden" name="product_id" value="{{ p.id }}">
                    <input
                      type="number"
                      name="qty"
                      min="1"
                      max="{{ p.stock }}"
                      value="1"
                      {% if p.stock == 0 %}disabled{% endif %}
                    >
                    <button
                      type="submit"
                      class="btn btn-primary btn-sm"
                      {% if p.stock == 0 %}disabled{% endif %}
                    >
                      åŠ å…¥è³¼ç‰©è»Š
                    </button>
                  </form>
                </div>
              </div>
            </div>

            {# ä¸‹åŠéƒ¨è©³ç´°è³‡è¨Šï¼ˆæŒ‰å³ä¸Šè§’ ? æ‰æœƒå±•é–‹ï¼‰ #}
            <div class="product-extra">
              <div class="product-extra-row">
                <span>æ·¨é‡ï¼š</span><span>{{ p.net_weight }}</span>
              </div>
              <div class="product-extra-row">
                <span>è£½é€ æ—¥æœŸï¼š</span><span>{{ p.mfg }}</span>
              </div>
              <div class="product-extra-row">
                <span>æœ‰æ•ˆæ—¥æœŸï¼š</span><span>{{ p.exp }}</span>
              </div>
              <div class="product-extra-row">
                <span>åŸç”¢åœ°ï¼š</span><span>{{ p.origin }}</span>
              </div>
              <div class="product-extra-note">
                æé†’ï¼šå¯¦éš›è³‡è¨Šä»¥å•†å“åŒ…è£æ¨™ç¤ºç‚ºä¸»ã€‚
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    </section>
  {% endfor %}
{% endblock %}
